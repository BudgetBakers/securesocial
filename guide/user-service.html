<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>SecureSocial - Authentication for Play Framework Applications</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<!-- Le styles --><link href="../stylesheets/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
<link href="../stylesheets/bootstrap-responsive.min.css" media="screen" rel="stylesheet" type="text/css">
<link href="../stylesheets/pygment.css" media="screen" rel="stylesheet" type="text/css">
<link href="../stylesheets/main.css" media="screen" rel="stylesheet" type="text/css">
<style type="text/css">
      body {
        padding-top: 20px;        
      }
    </style>
<!-- HTML5 shim, for IE6-8 support of HTML5 elements --><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div id="wrap">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../">SecureSocial</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
<li><a href="../">Home</a></li>
              <li class="active"><a href="getting-started.html">Getting Started</a></li>
              <!--li ><a href="../sponsors.html">Sponsors</a></li-->
              <li><a href="https://groups.google.com/forum/#!forum/securesocial" target="_blank">Forum</a></li>
              <li><a href="../support.html">Support</a></li>
              <li><a href="https://github.com/jaliss/securesocial" target="_blank">View on Github</a></li>                            
            </ul>
</div>
<!--/.nav-collapse -->
        </div>
      </div>
    </div>


    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="sidebar-nav">
  <ul class="nav nav-list">
<li class="nav-header">Contents</li>
        
    	<li>
    		<a href="getting-started.html">Getting Started</a> 
    	</li>
   	    
    	<li>
    		<a href="installation.html">Installation</a> 
    	</li>
   	    
    	<li>
    		<a href="configuration.html">Configuration</a> 
    	</li>
   	    
    	<li>
    		<a href="securing.html">Securing your Actions</a> 
    	</li>
   	    
    	<li>
    		<a href="authorization.html">Adding Authorization</a> 
    	</li>
   	    
    	<li class="active">
    		<a href="user-service.html">UserService</a> 
    	</li>
   	    
    	<li>
    		<a href="views-customization.html">Views and Emails Customization</a> 
    	</li>
   	    
    	<li>
    		<a href="password-change.html">Password Change Page</a> 
    	</li>
   	    
    	<li>
    		<a href="password-plugins.html">Password Plugins</a> 
    	</li>
   	    
    	<li>
    		<a href="events.html">Events</a> 
    	</li>
   	    
    	<li>
    		<a href="faqs.html">FAQs</a> 
    	</li>
   	    
    	<li>
    		<a href="changelog.html">Change Log</a> 
    	</li>
   	
    </ul>
</div>     
        </div>

        <div class="span9">                   
              <h1 id="userservice">UserService</h1>

<p>SecureSocial relies on an implementation of <code>UserService</code> to handle all the operations related to saving/finding users. Using this delegation model you are not forced to use a particular model object or a persistence mechanism but rather provide a service that translates back and forth between your models and what SecureSocial understands. </p>

<p>Besides users, this service is also in charge of persisting the tokens that are used in signup and reset password requests. Some of these methods are only required if you are going to use the <code>UsernamePasswordProvider</code>. If you do not plan to use it just provide an empty implementation for them.  Check the documentation in the source code to know which ones are optional.</p>

<h2 id="socialuser">SocialUser</h2>

<p><code>SocialUser</code> is an object that implements the <code>Identity</code> trait. An instance of this class is created by SecureSocial to gather information about the user when he signs up and/or signs in. </p>

<h2 id="identity-and-socialuser">Identity and SocialUser</h2>

<p>As you will see, some methods in <code>UserService</code> receive or return <code>Identity</code> instances.  When your implementation receives an <code>Identity</code> (eg: in the <code>save</code> method) the class instantiated is actually a <code>SocialUser</code>.  </p>

<p>When you return an <code>Identity</code> from the <code>find</code> method you can return an instance of a <code>SocialUser</code> or your own object that implements <code>Identity</code>. Since the instance that gets returned by <code>find</code> is passed back to your controller actions this allows you to use your own class when handling requests. This is useful because you can easily convert an <code>Identity</code> to your own model by using pattern matching in Scala or casting in Java.</p>

<p>As an example, if you had a <code>User</code> class that implemented <code>Identity</code> you'd convert it as follows:</p>

<div class="highlight"><pre><span class="k">def</span> <span class="n">myAction</span> <span class="k">=</span> <span class="nc">SecuredAction</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">request</span> <span class="k">=&gt;</span>
	<span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="k">match</span> <span class="o">{</span> 
		<span class="k">case</span> <span class="n">user</span><span class="k">:</span> <span class="kt">User</span> <span class="o">=&gt;</span> <span class="o">{</span>
			<span class="c1">// handle request</span>
		<span class="o">}</span>
	    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="c1">// did not get a User instance, log error throw exception </span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>In Java, you would do something like:</p>

<div class="highlight"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">myAction</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">ctx</span><span class="o">().</span><span class="na">args</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">SecureSocial</span><span class="o">.</span><span class="na">USER_KEY</span><span class="o">);</span>
    <span class="k">return</span> <span class="nf">ok</span><span class="o">(</span><span class="n">index</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">user</span><span class="o">));</span>
<span class="o">}</span>
</pre></div>

<h2 id="how-to-implement">How to implement</h2>

<p>For Scala you need to extend the <code>UserServicePlugin</code>. For example:</p>

<div class="highlight"><pre><span class="k">import</span> <span class="nn">play.api.Application</span>
<span class="k">import</span> <span class="nn">securesocial.core.</span><span class="o">{</span><span class="nc">Identity</span><span class="o">,</span> <span class="nc">IdentityId</span><span class="o">,</span> <span class="nc">UserServicePlugin</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">securesocial.core.providers.Token</span>


<span class="k">class</span> <span class="nc">MyUserService</span><span class="o">(</span><span class="n">application</span><span class="k">:</span> <span class="kt">Application</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">UserServicePlugin</span><span class="o">(</span><span class="n">application</span><span class="o">)</span> <span class="o">{</span>
  <span class="cm">/**</span>
<span class="cm">   * Finds a user that maches the specified id</span>
<span class="cm">   *</span>
<span class="cm">   * @param id the user id</span>
<span class="cm">   * @return an optional user</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">find</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">IdentityId</span><span class="o">)</span><span class="k">:</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Identity</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  	<span class="c1">// implement me</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Finds a user by email and provider id.</span>
<span class="cm">   *</span>
<span class="cm">   * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">   * implementation.</span>
<span class="cm">   *</span>
<span class="cm">   * @param email - the user email</span>
<span class="cm">   * @param providerId - the provider id</span>
<span class="cm">   * @return</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">findByEmailAndProvider</span><span class="o">(</span><span class="n">email</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">providerId</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Identity</span><span class="o">]</span> <span class="k">=</span>
  <span class="o">{</span>
  	<span class="c1">// implement me</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Saves the user.  This method gets called when a user logs in.</span>
<span class="cm">   * This is your chance to save the user information in your backing store.</span>
<span class="cm">   * @param user</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">save</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">Identity</span><span class="o">)</span> <span class="o">{</span>
  	<span class="c1">// implement me</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Saves a token.  This is needed for users that</span>
<span class="cm">   * are creating an account in the system instead of using one in a 3rd party system.</span>
<span class="cm">   *</span>
<span class="cm">   * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">   * implementation</span>
<span class="cm">   *</span>
<span class="cm">   * @param token The token to save</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">save</span><span class="o">(</span><span class="n">token</span><span class="k">:</span> <span class="kt">Token</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  	<span class="c1">// implement me</span>
  <span class="o">}</span>


  <span class="cm">/**</span>
<span class="cm">   * Finds a token</span>
<span class="cm">   *</span>
<span class="cm">   * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">   * implementation</span>
<span class="cm">   *</span>
<span class="cm">   * @param token the token id</span>
<span class="cm">   * @return</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">findToken</span><span class="o">(</span><span class="n">token</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Token</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  	<span class="c1">// implement me</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Deletes a token</span>
<span class="cm">   *</span>
<span class="cm">   * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">   * implementation</span>
<span class="cm">   *</span>
<span class="cm">   * @param uuid the token id</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">deleteToken</span><span class="o">(</span><span class="n">uuid</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
  	<span class="c1">// implement me</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Deletes all expired tokens</span>
<span class="cm">   *</span>
<span class="cm">   * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">   * implementation</span>
<span class="cm">   *</span>
<span class="cm">   */</span>
  <span class="k">def</span> <span class="n">deleteExpiredTokens</span><span class="o">()</span> <span class="o">{</span>
  	<span class="c1">// implement me</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>For Java, you need to extend the <code>BaseUserService</code> class.</p>

<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyUserService</span> <span class="kd">extends</span> <span class="n">BaseUserService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">MyUserService</span><span class="o">(</span><span class="n">Application</span> <span class="n">application</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">application</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Saves the user.  This method gets called when a user logs in.</span>
<span class="cm">     * This is your chance to save the user information in your backing store.</span>
<span class="cm">     * @param user</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSave</span><span class="o">(</span><span class="n">Identity</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// implement me</span>
    <span class="o">}</span>

	<span class="cm">/**</span>
<span class="cm">     * Finds an Identity in the backing store.	     </span>
<span class="cm">     * @return an Identity instance or null if no user matches the specified id</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Identity</span> <span class="nf">doFind</span><span class="o">(</span><span class="n">IdentityId</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// implement me</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Finds an identity by email and provider id.</span>
<span class="cm">     *</span>
<span class="cm">     * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">     * implementation.</span>
<span class="cm">     *</span>
<span class="cm">     * @param email - the user email</span>
<span class="cm">     * @param providerId - the provider id</span>
<span class="cm">     * @return an Identity instance or null if no user matches the specified id</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Identity</span> <span class="nf">doFindByEmailAndProvider</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">,</span> <span class="n">String</span> <span class="n">providerId</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// implement me</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Saves a token</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSave</span><span class="o">(</span><span class="n">Token</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// implement me</span>
    <span class="o">}</span>

	<span class="cm">/**</span>
<span class="cm">	 * Finds a token by id</span>
<span class="cm">	 *</span>
<span class="cm">	 * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">     * implementation</span>
<span class="cm">     *</span>
<span class="cm">	 * @return a Token instance or null if no token matches the id</span>
<span class="cm">	 */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Token</span> <span class="nf">doFindToken</span><span class="o">(</span><span class="n">String</span> <span class="n">tokenId</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// implement me</span>
    <span class="o">}</span>

    
 	<span class="cm">/**</span>
<span class="cm">     * Deletes a token</span>
<span class="cm">     *</span>
<span class="cm">     * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">     * implementation</span>
<span class="cm">     *</span>
<span class="cm">     * @param uuid the token id</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doDeleteToken</span><span class="o">(</span><span class="n">String</span> <span class="n">uuid</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// implement me</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Deletes all expired tokens</span>
<span class="cm">     *</span>
<span class="cm">     * Note: If you do not plan to use the UsernamePassword provider just provide en empty</span>
<span class="cm">     * implementation</span>
<span class="cm">     *</span>
<span class="cm">     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doDeleteExpiredTokens</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// implement me</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p><em>Note: the Scala and Java samples come with a memory based implementation that can be used as a starting point for your own implementation.</em></p>

<h1 id="important">Important</h1>

<p>Note that the <code>Token</code> class is implemented in Scala and Java.  Make sure you import the one that matches the language you are using in your <code>UserService</code> implementation.</p>
            
        </div>
      </div>    
    </div>
    <div id="push"></div>
    </div>
    <div id="footer">
	<div class="container">
		<p> <a href="https://github.com/jaliss/securesocial">View on Github</a></p>        
        <p>Designed and developed by <a href="http://twitter.com/jaliss" target="_blank">@jaliss</a>.</p>
        <p>Code licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a>, documentation under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
        <p>© 2011-2013 Jorge Aliss       
    </p>
</div>
       
</div>
      
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1441023-12']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
